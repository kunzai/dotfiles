
# Load completion system first
autoload -Uz compinit
compinit

# Enable vi mode
bindkey -v
export KEYTIMEOUT=1

# Mode indicator in prompt
function zle-line-init zle-keymap-select {
    RPS1="${${KEYMAP/vicmd/[NORMAL]}/(main|viins)/[INSERT]}"
    RPS2=$RPS1
    zle reset-prompt
}
zle -N zle-line-init
zle -N zle-keymap-select

# Load completion menu module
zmodload zsh/complist

# Completion menu vim bindings
bindkey -M viins "^[[Z" reverse-menu-complete
bindkey -M vicmd "k" up-line-or-history
bindkey -M vicmd "j" down-line-or-history

# Ensure backspace works as expected
bindkey "^?" backward-delete-char
bindkey "^W" backward-kill-word

# Better searching
bindkey "^R" history-incremental-search-backward
